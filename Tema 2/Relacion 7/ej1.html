<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Ubicaci√≥n con Leaflet (Simplificado JSDoc)</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        /* CSS m√≠nimo para que el mapa se muestre */
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>

<body>

    <h1>Mi Ubicaci√≥n Actual</h1>
    <p id="status">Verificando geolocalizaci√≥n...</p>

    <div id="map"></div>

    <script>
        // Variables globales necesarias
        let map;
        const statusElement = document.getElementById('status');

        /**
         * Inicializa y centra el mapa Leaflet en las coordenadas dadas.
         * A√±ade la capa base de OpenStreetMap y un marcador.
         * * @param {number} lat Latitud.
         * @param {number} lon Longitud.
         * @param {number} [zoom=15] Nivel de zoom inicial.
         */
        function initializeLeafletMap(lat, lon, zoom = 15) {
            // 1. Inicializa el mapa si a√∫n no existe
            if (!map) {
                map = L.map('map').setView([lat, lon], zoom);
            } else {
                // Si ya existe, solo reajusta la vista
                map.setView([lat, lon], zoom);
            }

            // 2. A√±ade la capa base de OpenStreetMap (Tiles)
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // 3. A√±ade un marcador en la ubicaci√≥n
            L.marker([lat, lon])
                .addTo(map)
                .bindPopup("Est√°s aqu√≠")
                .openPopup();
        }

        /**
         * Funci√≥n de √©xito de geolocalizaci√≥n.
         * Procesa las coordenadas y llama a initializeLeafletMap.
         * * @param {GeolocationPosition} position Objeto con las coordenadas.
         */
        function successCallback(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            statusElement.textContent = `Ubicaci√≥n obtenida: Latitud ${lat.toFixed(6)}, Longitud ${lon.toFixed(6)}`;
            statusElement.style.color = 'green';

            // Llama a la inicializaci√≥n del mapa con la posici√≥n obtenida
            initializeLeafletMap(lat, lon);
        }

        /**
         * Funci√≥n de error de geolocalizaci√≥n.
         * Muestra un mensaje de error y centra el mapa en el globo por defecto (0, 0).
         * * @param {GeolocationPositionError} error Objeto con la informaci√≥n del error.
         */
        function errorCallback(error) {
            statusElement.textContent = "‚ùå Error al obtener la ubicaci√≥n. Aseg√∫rate de dar permiso.";
            statusElement.style.color = 'red';

            // Centra en el centro del mapa mundial si falla la geolocalizaci√≥n
            initializeLeafletMap(0, 0, 2);
        }

        // Punto de Entrada: Ejecutar al cargar la p√°gina
        window.onload = function () {
            // 1. Verifica si el navegador soporta la API de Geolocalizaci√≥n
            if (navigator.geolocation) {
                statusElement.textContent = "Geolocalizaci√≥n disponible. Solicitando posici√≥n...";

                // 2. Llama a getCurrentPosition con las funciones de √©xito y error
                navigator.geolocation.getCurrentPosition(
                    successCallback,
                    errorCallback
                );
            } else {
                statusElement.textContent = "üö´ Su navegador no soporta la API de Geolocalizaci√≥n.";
                statusElement.style.color = 'red';
                // Muestra el mapa global de todos modos
                initializeLeafletMap(0, 0, 2);
            }
        };

    </script>

</body>

</html>